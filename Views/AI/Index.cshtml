@{
    ViewData["Title"] = "AI Egzersiz ve Diyet Uzmanı";
    Layout = "_Layout";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="text-center mb-5">
                <h1 class="display-4 fw-bold text-white mb-2"><i class="bi bi-robot me-3 text-primary"></i>AI Wellness
                    Coach</h1>
                <p class="lead text-secondary">Vücut tipinize ve hedeflerinize özel antrenman ve beslenme planı.</p>
            </div>

            <div class="card bg-dark border-secondary shadow-lg mb-5 overflow-hidden">
                <div class="card-header bg-primary bg-opacity-10 border-secondary py-3">
                    <h5 class="mb-0 text-white"><i class="bi bi-pencil-square me-2"></i>Bilgilerinizi Girin</h5>
                </div>
                <div class="card-body p-4 text-white">
                    <form id="aiForm">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">Yaş</label>
                                <input type="number" id="age" class="form-control bg-dark text-white border-secondary"
                                    required value="25">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Ağırlık (kg)</label>
                                <input type="number" id="weight"
                                    class="form-control bg-dark text-white border-secondary" required value="75">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Boy (cm)</label>
                                <input type="number" id="height"
                                    class="form-control bg-dark text-white border-secondary" required value="175">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Cinsiyet</label>
                                <select id="gender" class="form-select bg-dark text-white border-secondary">
                                    <option value="Erkek">Erkek</option>
                                    <option value="Kadın">Kadın</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Hedef</label>
                                <select id="goal" class="form-select bg-dark text-white border-secondary">
                                    <option value="Kilo Vermek">Kilo Vermek</option>
                                    <option value="Kas Yapmak">Kas Kütlesini Artırmak</option>
                                    <option value="Dayanıklılık">Dayanıklılık ve Kondisyon</option>
                                    <option value="Esneklik">Esneklik ve Denge</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100 py-3 mt-4 rounded-pill fw-bold shadow">
                            <i class="bi bi-magic me-2"></i>Analizi Başlat
                        </button>
                    </form>
                </div>
            </div>

            <!-- Loading Spinner -->
            <div id="loading" class="text-center my-5" style="display:none;">
                <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3 text-secondary">Yapay Zeka değerlerinizi hesaplıyor...</p>
            </div>

            <!-- Result Section -->
            <div id="resultCard" class="card bg-dark border-primary shadow-lg" style="display:none;">
                <div class="card-body p-5">
                    <div id="aiResponse" class="text-white ai-markdown">
                        <!-- AI Response Here -->
                    </div>
                    <hr class="border-secondary my-4">
                    <div class="d-flex align-items-center text-secondary">
                        <i class="bi bi-info-circle me-2"></i>
                        <small>Bu öneriler bir algoritma tarafından üretilmiştir. Uygulamadan önce doktorunuza
                            danışın.</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .ai-markdown h3 {
        color: #0d6efd;
        margin-bottom: 1.5rem;
    }

    .ai-markdown strong {
        color: #fff;
    }

    .ai-markdown p {
        line-height: 1.8;
        color: #ced4da;
    }
</style>

@section Scripts {
    <script>
        document.getElementById('aiForm').addEventListener('submit', function (e) {
            e.preventDefault();

            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultCard').style.display = 'none';

            const data = new URLSearchParams();
            data.append('age', document.getElementById('age').value);
            data.append('weight', document.getElementById('weight').value);
            data.append('height', document.getElementById('height').value);
            data.append('gender', document.getElementById('gender').value);
            data.append('goal', document.getElementById('goal').value);

            fetch('/AI/GetRecommendation', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: data
            })
                .then(r => r.json())
                .then(res => {
                    document.getElementById('loading').style.display = 'none';
                    if (res.success) {
                        // Simple replacement for markdown-like formatting
                        let fmt = res.recommendation
                            .replace(/### (.*)/g, '<h3>$1</h3>')
                            .replace(/\*\*(.*)\*\*/g, '<strong>$1</strong>')
                            .replace(/\n/g, '<br>');

                        document.getElementById('aiResponse').innerHTML = fmt;
                        document.getElementById('resultCard').style.display = 'block';
                        document.getElementById('resultCard').scrollIntoView({ behavior: 'smooth' });
                    }
                });
        });
    </script>
}
